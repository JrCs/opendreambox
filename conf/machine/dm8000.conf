#@TYPE: Machine
#@NAME: Dreambox DM8000
#@DESCRIPTION: Machine configuration for the Dreambox DM8000

TARGET_ARCH = "mipsel"
IPKG_ARCHS = "all mipsel ${MACHINE}"
PREFERRED_PROVIDER_xserver = "xserver-kdrive"
PREFERRED_PROVIDER_virtual/kernel = "linux-dm8000"

MACHINE_ESSENTIAL_EXTRA_RDEPENDS = "dreambox-dvb-modules \
	kernel-module-exportfs  \
	kernel-module-reiserfs	kernel-module-sd-mod \
	kernel-module-sg	kernel-module-sr-mod	 \
	kernel-module-usbhid	kernel-module-usbmon  \
	kernel-module-xfs gst-plugin-dvbmediasink"

PREFERRED_VERSION_linux-libc-headers = "2.6.12.0"

GLIBC_ADDONS = "ports,nptl,libidn"
TARGET_FPU = "soft"
#OLDEST_KERNEL = "2.6.9"
EXTRA_IMAGEDEPENDS += "dreambox-secondstage dreambox-buildimage-native"
EXTRA_IMAGECMD_jffs2 = " --eraseblock=0x20000 -n -l "
IMAGE_CMD_jffs2 = "mkfs.jffs2 --root=${IMAGE_ROOTFS}/boot --faketime -x lzo \
       --output=${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.boot.jffs2 \
       ${EXTRA_IMAGECMD}; rm -rf ${IMAGE_ROOTFS}/boot/*; \
				mkfs.jffs2 --root=${IMAGE_ROOTFS} --faketime -x lzo \
       --output=${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.jffs2 \
       ${EXTRA_IMAGECMD}; \
       buildimage ${STAGING_LIBDIR}/dreambox-secondstage/main.bin.gz \
       ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.boot.jffs2 \
       ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.rootfs.jffs2 \
       ${MACHINE} 64 large \
       > ${DEPLOY_DIR_IMAGE}/${IMAGE_NAME}.nfi"
